<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 400px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            margin-bottom: 10px;
        }

        h1 {
            color: #2d3748;
            font-size: 24px;
            text-align: center;
            margin-bottom: 8px;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            font-size: 13px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            color: #4a5568;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f7fafc;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input::placeholder {
            color: #a0aec0;
        }

        select {
            cursor: pointer;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .error {
            color: #e53e3e;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .hidden {
            display: none;
        }

        .pin-input-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .pin-digit {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            border: 3px solid #e2e8f0;
            border-radius: 12px;
            background: #f7fafc;
        }

        .pin-digit:focus {
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-bottom: 15px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .menu-button {
            padding: 20px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .menu-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .menu-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .menu-text {
            font-size: 13px;
            font-weight: 600;
            color: #2d3748;
        }

        .center-text {
            text-align: center;
        }

        .info-text {
            color: #718096;
            font-size: 14px;
            line-height: 1.6;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- –≠–∫—Ä–∞–Ω 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
            <div id="registrationForm">
                <div class="logo">
                    <div class="logo-icon">üìã</div>
                </div>
                <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                <p class="subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞</p>

                <form id="regForm">
                    <div class="form-group">
                        <label for="name">–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                        <input type="text" id="name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" required>
                        <div class="error" id="nameError">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è</div>
                    </div>

                    <div class="form-group">
                        <label for="phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <input type="tel" id="phone" placeholder="+998 90 123 45 67" required>
                        <div class="error" id="phoneError">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä</div>
                    </div>

                    <div class="form-group">
                        <label for="email">Email –∞–¥—Ä–µ—Å</label>
                        <input type="email" id="email" placeholder="example@mail.com" required>
                        <div class="error" id="emailError">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</div>
                    </div>

                    <div class="form-group">
                        <label for="region">–û–±–ª–∞—Å—Ç—å</label>
                        <select id="region" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="tashkent_city">–≥. –¢–∞—à–∫–µ–Ω—Ç</option>
                            <option value="andijan">–ê–Ω–¥–∏–∂–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="bukhara">–ë—É—Ö–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="jizzakh">–î–∂–∏–∑–∞–∫—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="kashkadarya">–ö–∞—à–∫–∞–¥–∞—Ä—å–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="navoi">–ù–∞–≤–æ–∏–π—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="namangan">–ù–∞–º–∞–Ω–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="samarkand">–°–∞–º–∞—Ä–∫–∞–Ω–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="surkhandarya">–°—É—Ä—Ö–∞–Ω–¥–∞—Ä—å–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="sirdarya">–°—ã—Ä–¥–∞—Ä—å–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="tashkent">–¢–∞—à–∫–µ–Ω—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="fergana">–§–µ—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="khorezm">–•–æ—Ä–µ–∑–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="karakalpakstan">–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞—Ä–∞–∫–∞–ª–ø–∞–∫—Å—Ç–∞–Ω</option>
                        </select>
                        <div class="error" id="regionError">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</div>
                    </div>

                    <button type="submit" class="btn" id="submitBtn">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </form>
            </div>

            <!-- –≠–∫—Ä–∞–Ω 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PIN -->
            <div id="pinSetupScreen" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üîê</div>
                </div>
                <h1>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PIN-–∫–æ–¥</h1>
                <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π PIN –¥–ª—è –∑–∞—â–∏—Ç—ã –∞–∫–∫–∞—É–Ω—Ç–∞</p>

                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" id="pin1" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="pin2" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="pin3" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="pin4" inputmode="numeric">
                </div>

                <div class="error center-text" id="pinError">PIN –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 4 —Ü–∏—Ñ—Ä</div>

                <button class="btn" id="setPinBtn">
                    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PIN
                </button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ PIN -->
            <div id="pinConfirmScreen" class="hidden">
                <div class="logo">
                    <div class="logo-icon">‚úÖ</div>
                </div>
                <h1>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ PIN-–∫–æ–¥</h1>
                <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ PIN –µ—â—ë —Ä–∞–∑ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>

                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin1" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin2" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin3" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin4" inputmode="numeric">
                </div>

                <div class="error center-text" id="confirmPinError">PIN-–∫–æ–¥—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç</div>

                <button class="btn" id="confirmPinBtn">
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω 4: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
            <div id="mainMenu" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üè†</div>
                </div>
                <h1>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h1>
                <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</p>

                <div class="menu-grid">
                    <div class="menu-button" onclick="openVisitRegistration()">
                        <div class="menu-icon">üìù</div>
                        <div class="menu-text">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–∏–∑–∏—Ç–∞</div>
                    </div>
                    <div class="menu-button" onclick="openReports()">
                        <div class="menu-icon">üìä</div>
                        <div class="menu-text">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç—ã</div>
                    </div>
                    <div class="menu-button" onclick="openTourPlan()">
                        <div class="menu-icon">üó∫Ô∏è</div>
                        <div class="menu-text">–¢—É—Ä –ø–ª–∞–Ω</div>
                    </div>
                    <div class="menu-button" onclick="openMaterials()">
                        <div class="menu-icon">üìö</div>
                        <div class="menu-text">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                    </div>
                    <div class="menu-button" onclick="openProjectPlan()">
                        <div class="menu-icon">üìã</div>
                        <div class="menu-text">–ü–ª–∞–Ω-–ø—Ä–æ–µ–∫—Ç</div>
                    </div>
                    <div class="menu-button" onclick="openHelp()">
                        <div class="menu-icon">‚ùì</div>
                        <div class="menu-text">–ü–æ–º–æ—â—å</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let userData = {};
        let userPin = '';

        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidPhone(phone) {
            return /^[\d\s\+\-\(\)]+$/.test(phone) && phone.replace(/\D/g, '').length >= 9;
        }

        function showError(fieldId, show) {
            document.getElementById(fieldId + 'Error').style.display = show ? 'block' : 'none';
        }

        function showScreen(screenId) {
            ['registrationForm', 'pinSetupScreen', 'pinConfirmScreen', 'mainMenu'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        document.getElementById('regForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const region = document.getElementById('region').value;

            let isValid = true;

            if (name.length < 2) {
                showError('name', true);
                isValid = false;
            } else {
                showError('name', false);
            }

            if (!isValidPhone(phone)) {
                showError('phone', true);
                isValid = false;
            } else {
                showError('phone', false);
            }

            if (!isValidEmail(email)) {
                showError('email', true);
                isValid = false;
            } else {
                showError('email', false);
            }

            if (!region) {
                showError('region', true);
                isValid = false;
            } else {
                showError('region', false);
            }

            if (isValid) {
                userData = {
                    name,
                    phone,
                    email,
                    region,
                    telegramId: tg.initDataUnsafe?.user?.id || 'unknown',
                    username: tg.initDataUnsafe?.user?.username || 'unknown'
                };

                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }

                showScreen('pinSetupScreen');
                document.getElementById('pin1').focus();
            } else {
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
            }
        });

        // PIN –Ω–∞–≤–∏–≥–∞—Ü–∏—è
        function setupPinNavigation(prefix) {
            for (let i = 1; i <= 4; i++) {
                const input = document.getElementById(prefix + i);
                
                input.addEventListener('input', (e) => {
                    if (e.target.value && i < 4) {
                        document.getElementById(prefix + (i + 1)).focus();
                    }
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value && i > 1) {
                        document.getElementById(prefix + (i - 1)).focus();
                    }
                });
            }
        }

        setupPinNavigation('pin');
        setupPinNavigation('confirmPin');

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PIN
        document.getElementById('setPinBtn').addEventListener('click', () => {
            const pin1 = document.getElementById('pin1').value;
            const pin2 = document.getElementById('pin2').value;
            const pin3 = document.getElementById('pin3').value;
            const pin4 = document.getElementById('pin4').value;

            if (pin1 && pin2 && pin3 && pin4) {
                userPin = pin1 + pin2 + pin3 + pin4;
                showError('pin', false);
                
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }

                showScreen('pinConfirmScreen');
                document.getElementById('confirmPin1').focus();
            } else {
                showError('pin', true);
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
            }
        });

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ PIN
        document.getElementById('confirmPinBtn').addEventListener('click', () => {
            const confirmPin1 = document.getElementById('confirmPin1').value;
            const confirmPin2 = document.getElementById('confirmPin2').value;
            const confirmPin3 = document.getElementById('confirmPin3').value;
            const confirmPin4 = document.getElementById('confirmPin4').value;
            const confirmPin = confirmPin1 + confirmPin2 + confirmPin3 + confirmPin4;

            if (confirmPin === userPin) {
                userData.pin = userPin;
                showError('confirmPin', false);

                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }

                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
                tg.sendData(JSON.stringify({
                    action: 'registration',
                    data: userData
                }));

                showScreen('mainMenu');
            } else {
                showError('confirmPin', true);
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é (–∑–∞–≥–ª—É—à–∫–∏)
        function openVisitRegistration() {
            alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–∏–∑–∏—Ç–∞ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function openReports() {
            alert('–û—Ç—á–µ—Ç—ã - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function openTourPlan() {
            alert('–¢—É—Ä –ø–ª–∞–Ω - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function openMaterials() {
            alert('–ú–∞—Ç–µ—Ä–∏–∞–ª—ã - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function openProjectPlan() {
            alert('–ü–ª–∞–Ω-–ø—Ä–æ–µ–∫—Ç - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function openHelp() {
            alert('–ü–æ–º–æ—â—å - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        // –£–±—Ä–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
        ['name', 'phone', 'email', 'region'].forEach(field => {
            document.getElementById(field).addEventListener('input', () => {
                showError(field, false);
            });
        });
    </script>
</body>
</html>
