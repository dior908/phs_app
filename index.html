<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–∑–∏—Ç–∞–º–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: pan-y;
            -webkit-user-select: none;
            user-select: none;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 400px;
        }

        .card {
            background: linear-gradient(145deg, #e6e9ed 0%, #c5ccd4 100%);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 
                8px 8px 16px rgba(0, 0, 0, 0.2),
                -8px -8px 16px rgba(255, 255, 255, 0.5);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #95a5a6, #7f8c8d);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            margin-bottom: 10px;
            box-shadow: 
                4px 4px 8px rgba(0, 0, 0, 0.2),
                -4px -4px 8px rgba(255, 255, 255, 0.5);
        }

        h1 {
            color: #2c3e50;
            font-size: 26px;
            text-align: center;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .subtitle {
            text-align: center;
            color: #546e7a;
            font-size: 14px;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            color: #37474f;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
            background: #d1d9e0;
            box-shadow: 
                inset 3px 3px 6px rgba(0, 0, 0, 0.1),
                inset -3px -3px 6px rgba(255, 255, 255, 0.5);
            color: #2c3e50;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            background: #dfe6ed;
            box-shadow: 
                inset 2px 2px 5px rgba(0, 0, 0, 0.15),
                inset -2px -2px 5px rgba(255, 255, 255, 0.7);
        }

        input::placeholder, textarea::placeholder {
            color: #78909c;
        }

        select {
            cursor: pointer;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(145deg, #95a5a6, #7f8c8d);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            box-shadow: 
                4px 4px 8px rgba(0, 0, 0, 0.2),
                -4px -4px 8px rgba(255, 255, 255, 0.3);
            font-family: 'Inter', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                6px 6px 12px rgba(0, 0, 0, 0.25),
                -6px -6px 12px rgba(255, 255, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 
                inset 3px 3px 6px rgba(0, 0, 0, 0.2),
                inset -3px -3px 6px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(145deg, #b0bec5, #90a4ae);
        }

        .btn-success {
            background: linear-gradient(145deg, #66bb6a, #4caf50);
        }

        .error {
            color: #d32f2f;
            font-size: 13px;
            margin-top: 8px;
            display: none;
            background: rgba(244, 67, 54, 0.1);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #d32f2f;
        }

        .error.show {
            display: block;
        }

        .hidden {
            display: none;
        }

        .pin-input-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .pin-digit {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: 28px;
            font-weight: bold;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .menu-button {
            padding: 20px;
            background: linear-gradient(145deg, #e6e9ed, #cfd8dc);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 
                4px 4px 8px rgba(0, 0, 0, 0.15),
                -4px -4px 8px rgba(255, 255, 255, 0.5);
        }

        .menu-button:hover {
            transform: translateY(-3px);
            box-shadow: 
                6px 6px 12px rgba(0, 0, 0, 0.2),
                -6px -6px 12px rgba(255, 255, 255, 0.6);
        }

        .menu-button:active {
            transform: translateY(0);
            box-shadow: 
                inset 3px 3px 6px rgba(0, 0, 0, 0.1),
                inset -3px -3px 6px rgba(255, 255, 255, 0.5);
        }

        .menu-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .menu-text {
            font-size: 13px;
            font-weight: 600;
            color: #37474f;
        }

        .lang-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .lang-btn {
            flex: 1;
            padding: 12px;
            background: linear-gradient(145deg, #d1d9e0, #b8c5d0);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #37474f;
            font-family: 'Inter', sans-serif;
            box-shadow: 
                3px 3px 6px rgba(0, 0, 0, 0.15),
                -3px -3px 6px rgba(255, 255, 255, 0.5);
        }

        .lang-btn.active {
            background: linear-gradient(145deg, #95a5a6, #7f8c8d);
            color: white;
            box-shadow: 
                inset 3px 3px 6px rgba(0, 0, 0, 0.2),
                inset -3px -3px 6px rgba(255, 255, 255, 0.2);
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid rgba(0,0,0,0.1);
            border-top: 3px solid #7f8c8d;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .location-btn {
            background: linear-gradient(145deg, #42a5f5, #1e88e5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .admin-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #ffa726, #ff9800);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 
                3px 3px 6px rgba(0, 0, 0, 0.2),
                -3px -3px 6px rgba(255, 255, 255, 0.3);
        }

        .admin-icon:active {
            box-shadow: 
                inset 2px 2px 4px rgba(0, 0, 0, 0.2),
                inset -2px -2px 4px rgba(255, 255, 255, 0.2);
        }

        .char-counter {
            text-align: right;
            font-size: 12px;
            color: #78909c;
            margin-top: 4px;
        }

        .required {
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container" style="position: relative;">
        <div class="admin-icon" onclick="openAdminPanel()" title="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å">‚öôÔ∏è</div>
        
        <div class="card">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div id="loadingScreen" class="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px; color: #546e7a;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ –ø–æ PIN -->
            <div id="pinLoginScreen" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üîê</div>
                </div>
                <h1 id="loginTitle">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
                <p class="subtitle" id="loginSubtitle">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à PIN-–∫–æ–¥</p>

                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" id="loginPin1" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="loginPin2" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="loginPin3" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="loginPin4" inputmode="numeric">
                </div>

                <div class="error" id="loginPinError">–ù–µ–≤–µ—Ä–Ω—ã–π PIN-–∫–æ–¥</div>

                <button class="btn" id="loginBtn">–í–æ–π—Ç–∏</button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="registrationForm" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üìã</div>
                </div>
                <h1 id="regTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                <p class="subtitle" id="regSubtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ</p>

                <form id="regForm">
                    <div class="form-group">
                        <label for="name" id="nameLabel">–ü–æ–ª–Ω–æ–µ –∏–º—è <span class="required">*</span></label>
                        <input type="text" id="name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" required>
                        <div class="error" id="nameError">–í–≤–µ–¥–∏—Ç–µ –∏–º—è</div>
                    </div>

                    <div class="form-group">
                        <label for="phone" id="phoneLabel">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ <span class="required">*</span></label>
                        <input type="tel" id="phone" placeholder="+998 90 123 45 67" required>
                        <div class="error" id="phoneError">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä</div>
                    </div>

                    <div class="form-group">
                        <label for="email" id="emailLabel">Email –∞–¥—Ä–µ—Å <span class="required">*</span></label>
                        <input type="email" id="email" placeholder="example@mail.com" required>
                        <div class="error" id="emailError">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</div>
                    </div>

                    <div class="form-group">
                        <label for="region" id="regionLabel">–û–±–ª–∞—Å—Ç—å <span class="required">*</span></label>
                        <select id="region" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="tashkent_city">–≥. –¢–∞—à–∫–µ–Ω—Ç</option>
                            <option value="andijan">–ê–Ω–¥–∏–∂–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="bukhara">–ë—É—Ö–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="jizzakh">–î–∂–∏–∑–∞–∫—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="kashkadarya">–ö–∞—à–∫–∞–¥–∞—Ä—å–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="navoi">–ù–∞–≤–æ–∏–π—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="namangan">–ù–∞–º–∞–Ω–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="samarkand">–°–∞–º–∞—Ä–∫–∞–Ω–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="surkhandarya">–°—É—Ä—Ö–∞–Ω–¥–∞—Ä—å–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="sirdarya">–°—ã—Ä–¥–∞—Ä—å–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="tashkent">–¢–∞—à–∫–µ–Ω—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="fergana">–§–µ—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="khorezm">–•–æ—Ä–µ–∑–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="karakalpakstan">–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞—Ä–∞–∫–∞–ª–ø–∞–∫—Å—Ç–∞–Ω</option>
                        </select>
                        <div class="error" id="regionError">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</div>
                    </div>

                    <button type="submit" class="btn" id="regSubmitBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                </form>
            </div>

            <!-- –≠–∫—Ä–∞–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PIN -->
            <div id="pinSetupScreen" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üîê</div>
                </div>
                <h1 id="pinSetupTitle">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PIN-–∫–æ–¥</h1>
                <p class="subtitle" id="pinSetupSubtitle">–í–≤–µ–¥–∏—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π PIN</p>

                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" id="pin1" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="pin2" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="pin3" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="pin4" inputmode="numeric">
                </div>

                <div class="error" id="pinError">PIN –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 4 —Ü–∏—Ñ—Ä</div>

                <button class="btn" id="setPinBtn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PIN</button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è PIN -->
            <div id="pinConfirmScreen" class="hidden">
                <div class="logo">
                    <div class="logo-icon">‚úÖ</div>
                </div>
                <h1 id="pinConfirmTitle">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ PIN-–∫–æ–¥</h1>
                <p class="subtitle" id="pinConfirmSubtitle">–í–≤–µ–¥–∏—Ç–µ PIN –µ—â—ë —Ä–∞–∑</p>

                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin1" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin2" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin3" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="confirmPin4" inputmode="numeric">
                </div>

                <div class="error" id="confirmPinError">PIN-–∫–æ–¥—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç</div>

                <button class="btn" id="confirmPinBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>

            <!-- –í—ã–±–æ—Ä —è–∑—ã–∫–∞ -->
            <div id="languageScreen" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üåê</div>
                </div>
                <h1>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / Tilni tanlang</h1>
                <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —è–∑—ã–∫</p>

                <div class="lang-selector">
                    <button class="lang-btn" onclick="setLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
                    <button class="lang-btn" onclick="setLanguage('uz')">üá∫üáø O'zbekcha</button>
                </div>
            </div>

            <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
            <div id="mainMenu" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üè†</div>
                </div>
                <h1 id="menuTitle">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h1>
                <p class="subtitle" id="menuSubtitle">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</p>

                <div class="menu-grid">
                    <div class="menu-button" onclick="openVisitMenu()">
                        <div class="menu-icon">üìù</div>
                        <div class="menu-text" id="menuVisit">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–∏–∑–∏—Ç–∞</div>
                    </div>
                    <div class="menu-button" onclick="openSection('map')">
                        <div class="menu-icon">üó∫Ô∏è</div>
                        <div class="menu-text" id="menuMap">–ö–∞—Ä—Ç–∞ –≤–∏–∑–∏—Ç–æ–≤</div>
                    </div>
                    <div class="menu-button" onclick="openSection('reports')">
                        <div class="menu-icon">üìä</div>
                        <div class="menu-text" id="menuReports">–û—Ç—á–µ—Ç—ã</div>
                    </div>
                    <div class="menu-button" onclick="openSection('tour')">
                        <div class="menu-icon">üóìÔ∏è</div>
                        <div class="menu-text" id="menuTour">–¢—É—Ä –ø–ª–∞–Ω</div>
                    </div>
                    <div class="menu-button" onclick="openSection('materials')">
                        <div class="menu-icon">üìö</div>
                        <div class="menu-text" id="menuMaterials">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                    </div>
                    <div class="menu-button" onclick="openSection('help')">
                        <div class="menu-icon">‚ùì</div>
                        <div class="menu-text" id="menuHelp">–ü–æ–º–æ—â—å</div>
                    </div>
                </div>
            </div>

            <!-- –ú–µ–Ω—é —Ç–∏–ø–æ–≤ –≤–∏–∑–∏—Ç–æ–≤ -->
            <div id="visitTypeMenu" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üìù</div>
                </div>
                <h1 id="visitTypeTitle">–¢–∏–ø –≤–∏–∑–∏—Ç–∞</h1>
                <p class="subtitle" id="visitTypeSubtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≤–∏–∑–∏—Ç–∞</p>

                <div class="menu-grid">
                    <div class="menu-button" onclick="openVisitForm('doctor')">
                        <div class="menu-icon">üë®‚Äç‚öïÔ∏è</div>
                        <div class="menu-text" id="visitDoctor">–í—Ä–∞—á</div>
                    </div>
                    <div class="menu-button" onclick="openVisitForm('pharmacy')">
                        <div class="menu-icon">üíä</div>
                        <div class="menu-text" id="visitPharmacy">–ê–ø—Ç–µ–∫–∞</div>
                    </div>
                    <div class="menu-button" onclick="openVisitForm('wholesale')">
                        <div class="menu-icon">üì¶</div>
                        <div class="menu-text" id="visitWholesale">–û–ø—Ç–æ–º</div>
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="backToMainMenu()" style="margin-top: 15px;" id="backBtn">–í–µ—Ä–Ω—É—Ç—å—Å—è</button>
            </div>

            <!-- –§–æ—Ä–º–∞ –≤–∏–∑–∏—Ç–∞ –∫ –≤—Ä–∞—á—É -->
            <div id="doctorVisitForm" class="hidden">
                <div class="logo">
                    <div class="logo-icon">üë®‚Äç‚öïÔ∏è</div>
                </div>
                <h1 id="doctorFormTitle">–í–∏–∑–∏—Ç –∫ –≤—Ä–∞—á—É</h1>
                <p class="subtitle" id="doctorFormSubtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–∏–∑–∏—Ç–µ</p>

                <form id="doctorForm">
                    <div class="form-group">
                        <label for="doctorName" id="doctorNameLabel">–§–ò–û –í—Ä–∞—á–∞ <span class="required">*</span></label>
                        <input type="text" id="doctorName" required>
                        <div class="error" id="doctorNameError">–í–≤–µ–¥–∏—Ç–µ –§–ò–û –≤—Ä–∞—á–∞</div>
                    </div>

                    <div class="form-group">
                        <label for="doctorPhone" id="doctorPhoneLabel">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤—Ä–∞—á–∞</label>
                        <input type="tel" id="doctorPhone">
                    </div>

                    <div class="form-group">
                        <label for="organization" id="organizationLabel">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è <span class="required">*</span></label>
                        <input type="text" id="organization" required>
                        <div class="error" id="organizationError">–í–≤–µ–¥–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é</div>
                    </div>

                    <div class="form-group">
                        <label for="specialty" id="specialtyLabel">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å <span class="required">*</span></label>
                        <input type="text" id="specialty" required>
                        <div class="error" id="specialtyError">–í–≤–µ–¥–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</div>
                    </div>

                    <div class="form-group">
                        <label for="visitTopic" id="visitTopicLabel">–¢–µ–º–∞ –≤–∏–∑–∏—Ç–∞ <span class="required">*</span></label>
                        <input type="text" id="visitTopic" required>
                        <div class="error" id="visitTopicError">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –≤–∏–∑–∏—Ç–∞</div>
                    </div>

                    <div class="form-group">
                        <label for="visitResult" id="visitResultLabel">–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∑–∏—Ç–∞ <span class="required">*</span></label>
                        <textarea id="visitResult" required minlength="20"></textarea>
                        <div class="char-counter"><span id="resultCounter">0</span>/20 –º–∏–Ω–∏–º—É–º</div>
                        <div class="error" id="visitResultError">–ú–∏–Ω–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤</div>
                    </div>

                    <button type="button" class="btn location-btn" onclick="getLocation()" id="locationBtn">
                        üìç –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π
                    </button>
                    <div id="locationStatus" style="text-align: center; margin-top: 10px; color: #546e7a; font-size: 13px;"></div>

                    <button type="submit" class="btn btn-success" id="submitVisitBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∏–∑–∏—Ç</button>
                    <button type="button" class="btn btn-secondary" onclick="backToVisitMenu()" id="backToVisitBtn">–ù–∞–∑–∞–¥</button>
                </form>
            </div>

            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤—Ö–æ–¥ -->
            <div id="adminLoginScreen" class="hidden">
                <div class="logo">
                    <div class="logo-icon">‚öôÔ∏è</div>
                </div>
                <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>

                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" id="adminPin1" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="adminPin2" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="adminPin3" inputmode="numeric">
                    <input type="password" maxlength="1" class="pin-digit" id="adminPin4" inputmode="numeric">
                </div>

                <div class="error" id="adminPinError">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>

                <button class="btn" onclick="checkAdminPassword()">–í–æ–π—Ç–∏</button>
                <button class="btn btn-secondary" onclick="closeAdminPanel()">–û—Ç–º–µ–Ω–∞</button>
            </div>

            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
            <div id="adminPanel" class="hidden">
                <div class="logo">
                    <div class="logo-icon">‚öôÔ∏è</div>
                </div>
                <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</p>

                <div id="adminStats" style="background: rgba(255,255,255,0.3); padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <p style="color: #37474f; font-weight: 600; margin-bottom: 10px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å</p>
                </div>

                <button class="btn btn-secondary" onclick="backToMainMenu()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let userData = {};
        let userPin = '';
        let currentLanguage = 'ru';
        let visitLocation = null;
        let previousScreen = null;

        const translations = {
            ru: {
                loginTitle: '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É',
                loginSubtitle: '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à PIN-–∫–æ–¥',
                regTitle: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
                regSubtitle: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ',
                nameLabel: '–ü–æ–ª–Ω–æ–µ –∏–º—è',
                phoneLabel: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞',
                emailLabel: 'Email –∞–¥—Ä–µ—Å',
                regionLabel: '–û–±–ª–∞—Å—Ç—å',
                pinSetupTitle: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PIN-–∫–æ–¥',
                pinSetupSubtitle: '–í–≤–µ–¥–∏—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π PIN',
                pinConfirmTitle: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ PIN-–∫–æ–¥',
                pinConfirmSubtitle: '–í–≤–µ–¥–∏—Ç–µ PIN –µ—â—ë —Ä–∞–∑',
                menuTitle: '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
                menuSubtitle: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ',
                menuVisit: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–∏–∑–∏—Ç–∞',
                menuMap: '–ö–∞—Ä—Ç–∞ –≤–∏–∑–∏—Ç–æ–≤',
                menuReports: '–û—Ç—á–µ—Ç—ã',
                menuTour: '–¢—É—Ä –ø–ª–∞–Ω',
                menuMaterials: '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã',
                menuHelp: '–ü–æ–º–æ—â—å',
                visitTypeTitle: '–¢–∏–ø –≤–∏–∑–∏—Ç–∞',
                visitTypeSubtitle: '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≤–∏–∑–∏—Ç–∞',
                visitDoctor: '–í—Ä–∞—á',
                visitPharmacy: '–ê–ø—Ç–µ–∫–∞',
                visitWholesale: '–û–ø—Ç–æ–º',
                backBtn: '–í–µ—Ä–Ω—É—Ç—å—Å—è',
                doctorFormTitle: '–í–∏–∑–∏—Ç –∫ –≤—Ä–∞—á—É',
                doctorFormSubtitle: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–∏–∑–∏—Ç–µ',
                doctorNameLabel: '–§–ò–û –í—Ä–∞—á–∞',
                doctorPhoneLabel: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤—Ä–∞—á–∞',
                organizationLabel: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è',
                specialtyLabel: '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å',
                visitTopicLabel: '–¢–µ–º–∞ –≤–∏–∑–∏—Ç–∞',
                visitResultLabel: '–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∑–∏—Ç–∞',
                locationBtn: 'üìç –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π',
                submitVisitBtn: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∏–∑–∏—Ç',
                backToVisitBtn: '–ù–∞–∑–∞–¥'
            },
            uz: {
                loginTitle: 'Tizimga kirish',
                loginSubtitle: 'PIN-kodingizni kiriting',
                regTitle: "Ro'yxatdan o'tish",
                regSubtitle: "Ma'lumotlarni to'ldiring",
                nameLabel: 'To\'liq ism',
                phoneLabel: 'Telefon raqami',
                emailLabel: 'Email manzil',
                regionLabel: 'Viloyat',
                pinSetupTitle: 'PIN-kod o\'rnating',
                pinSetupSubtitle: '4 xonali PIN kiriting',
                pinConfirmTitle: 'PIN-kodni tasdiqlang',
                pinConfirmSubtitle: 'PIN-ni yana bir marta kiriting',
                menuTitle: 'Asosiy menyu',
                menuSubtitle: 'Harakatni tanlang',
                menuVisit: 'Tashrif ro\'yxati',
                menuMap: 'Tashriflar xaritasi',
                menuReports: 'Hisobotlar',
                menuTour: 'Tur rejasi',
                menuMaterials: 'Materiallar',
                menuHelp: 'Yordam',
                visitTypeTitle: 'Tashrif turi',
                visitTypeSubtitle: 'Tashrif turini tanlang',
                visitDoctor: 'Shifokor',
                visitPharmacy: 'Dorixona',
                visitWholesale: 'Ulgurji',
                backBtn: 'Ortga',
                doctorFormTitle: 'Shifokor tashrif–∏',
                doctorFormSubtitle: 'Tashrif ma\'lumotlarini to\'ldiring',
                doctorNameLabel: 'Shifokor F.I.O',
                doctorPhoneLabel: 'Shifokor telefon raqami',
                organizationLabel: 'Tashkilot',
                specialtyLabel: 'Mutaxassislik',
                visitTopicLabel: 'Tashrif mavzusi',
                visitResultLabel: 'Tashrif natijasi',
                locationBtn: 'üìç Joylashuvni ulashish',
                submitVisitBtn: 'Tashrifni saqlash',
                backToVisitBtn: 'Ortga'
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            updateLanguage();
            showScreen('mainMenu');
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            Object.keys(t).forEach(key => {
                const el = document.getElementById(key);
                if (el) {
                    if (el.tagName === 'BUTTON' || el.tagName === 'DIV') {
                        el.textContent = t[key];
                    } else {
                        el.innerHTML = t[key];
                    }
                }
            });
        }

        function showScreen(screenId) {
            if (screenId !== 'adminLoginScreen' && screenId !== 'adminPanel') {
                previousScreen = Array.from(document.querySelectorAll('.card > div:not(.hidden)')).find(el => !el.classList.contains('hidden'))?.id;
            }
            
            document.querySelectorAll('.card > div').forEach(el => el.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            updateLanguage();
        }

        function showError(fieldId, message) {
            const errorEl = document.getElementById(fieldId + 'Error');
            if (message) {
                if (currentLanguage === 'uz') {
                    const uzErrors = {
                        'name': "Ismingizni kiriting",
                        'phone': "To'g'ri telefon raqamini kiriting",
                        'email': "To'g'ri email kiriting",
                        'region': "Viloyatni tanlang",
                        'loginPin': "Noto'g'ri PIN-kod",
                        'pin': "PIN 4 raqamdan iborat bo'lishi kerak",
                        'confirmPin': "PIN-kodlar mos kelmadi",
                        'doctorName': "Shifokor F.I.O ni kiriting",
                        'organization': "Tashkilotni kiriting",
                        'specialty': "Mutaxassislikni kiriting",
                        'visitTopic': "Tashrif mavzusini kiriting",
                        'visitResult': "Kamida 20 belgi",
                        'adminPin': "Noto'g'ri parol"
                    };
                    errorEl.textContent = uzErrors[fieldId] || message;
                } else {
                    errorEl.textContent = message;
                }
                errorEl.classList.add('show');
            } else {
                errorEl.classList.remove('show');
            }
        }

        function hideAllErrors() {
            document.querySelectorAll('.error').forEach(el => el.classList.remove('show'));
        }

        async function checkRegistration() {
            const userId = tg.initDataUnsafe?.user?.id;
            const savedUser = localStorage.getItem('user_' + userId);
            const savedLang = localStorage.getItem('appLanguage');
            
            if (savedLang) {
                currentLanguage = savedLang;
            }
            
            if (savedUser) {
                showScreen('pinLoginScreen');
                document.getElementById('loginPin1').focus();
            } else {
                showScreen('registrationForm');
            }
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidPhone(phone) {
            return /^[\d\s\+\-\(\)]+$/.test(phone) && phone.replace(/\D/g, '').length >= 9;
        }

        function setupPinNavigation(prefix) {
            for (let i = 1; i <= 4; i++) {
                const input = document.getElementById(prefix + i);
                if (!input) continue;
                
                input.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '');
                    if (e.target.value && i < 4) {
                        document.getElementById(prefix + (i + 1)).focus();
                    }
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value && i > 1) {
                        document.getElementById(prefix + (i - 1)).focus();
                    }
                });
            }
        }

        setupPinNavigation('loginPin');
        setupPinNavigation('pin');
        setupPinNavigation('confirmPin');
        setupPinNavigation('adminPin');

        document.getElementById('loginBtn').addEventListener('click', () => {
            const pin = ['loginPin1', 'loginPin2', 'loginPin3', 'loginPin4']
                .map(id => document.getElementById(id).value).join('');
            
            const userId = tg.initDataUnsafe?.user?.id;
            const savedData = JSON.parse(localStorage.getItem('user_' + userId) || '{}');
            
            if (pin === savedData.pin) {
                hideAllErrors();
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                showScreen('mainMenu');
            } else {
                showError('loginPin', '–ù–µ–≤–µ—Ä–Ω—ã–π PIN-–∫–æ–¥');
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                ['loginPin1', 'loginPin2', 'loginPin3', 'loginPin4'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                document.getElementById('loginPin1').focus();
            }
        });

        document.getElementById('regForm').addEventListener('submit', (e) => {
            e.preventDefault();
            hideAllErrors();

            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const region = document.getElementById('region').value;

            let isValid = true;

            if (name.length < 2) {
                showError('name', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                isValid = false;
            }

            if (!isValidPhone(phone)) {
                showError('phone', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä');
                isValid = false;
            }

            if (!isValidEmail(email)) {
                showError('email', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
                isValid = false;
            }

            if (!region) {
                showError('region', '–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å');
                isValid = false;
            }

            if (isValid) {
                userData = { name, phone, email, region,
                    telegramId: tg.initDataUnsafe?.user?.id || 'unknown',
                    username: tg.initDataUnsafe?.user?.username || 'unknown'
                };

                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                showScreen('pinSetupScreen');
                document.getElementById('pin1').focus();
            } else {
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
            }
        });

        document.getElementById('setPinBtn').addEventListener('click', () => {
            const pin = ['pin1', 'pin2', 'pin3', 'pin4']
                .map(id => document.getElementById(id).value).join('');

            if (pin.length === 4 && /^\d+$/.test(pin)) {
                userPin = pin;
                hideAllErrors();
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                showScreen('pinConfirmScreen');
                document.getElementById('confirmPin1').focus();
            } else {
                showError('pin', 'PIN –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 4 —Ü–∏—Ñ—Ä');
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
            }
        });

        document.getElementById('confirmPinBtn').addEventListener('click', () => {
            const confirmPin = ['confirmPin1', 'confirmPin2', 'confirmPin3', 'confirmPin4']
                .map(id => document.getElementById(id).value).join('');

            if (confirmPin === userPin) {
                userData.pin = userPin;
                hideAllErrors();
                
                const userId = tg.initDataUnsafe?.user?.id;
                localStorage.setItem('user_' + userId, JSON.stringify(userData));

                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');

                tg.sendData(JSON.stringify({
                    action: 'registration',
                    data: userData
                }));

                showScreen('languageScreen');
            } else {
                showError('confirmPin', 'PIN-–∫–æ–¥—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                ['confirmPin1', 'confirmPin2', 'confirmPin3', 'confirmPin4'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                document.getElementById('confirmPin1').focus();
            }
        });

        // –í–∏–∑–∏—Ç—ã
        function openVisitMenu() {
            showScreen('visitTypeMenu');
        }

        function openVisitForm(type) {
            if (type === 'doctor') {
                showScreen('doctorVisitForm');
            } else {
                alert(currentLanguage === 'ru' ? '–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ' : 'Ishlab chiqilmoqda');
            }
        }

        function backToMainMenu() {
            showScreen('mainMenu');
        }

        function backToVisitMenu() {
            showScreen('visitTypeMenu');
        }

        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
        document.getElementById('visitResult')?.addEventListener('input', (e) => {
            document.getElementById('resultCounter').textContent = e.target.value.length;
        });

        // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
        function getLocation() {
            const btn = document.getElementById('locationBtn');
            const status = document.getElementById('locationStatus');
            
            btn.disabled = true;
            status.textContent = currentLanguage === 'ru' ? '–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...' : 'Koordinatalar olinmoqda...';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        visitLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        status.textContent = currentLanguage === 'ru' ? '‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞' : '‚úÖ Joylashuv olindi';
                        btn.disabled = false;
                        if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                    },
                    (error) => {
                        status.textContent = currentLanguage === 'ru' ? '‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏' : '‚ùå Joylashuvni olishda xato';
                        btn.disabled = false;
                        if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                    }
                );
            } else {
                status.textContent = currentLanguage === 'ru' ? '‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '‚ùå Joylashuv qo\'llab-quvvatlanmaydi';
                btn.disabled = false;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –≤–∏–∑–∏—Ç–∞
        document.getElementById('doctorForm').addEventListener('submit', (e) => {
            e.preventDefault();
            hideAllErrors();

            const doctorName = document.getElementById('doctorName').value.trim();
            const doctorPhone = document.getElementById('doctorPhone').value.trim();
            const organization = document.getElementById('organization').value.trim();
            const specialty = document.getElementById('specialty').value.trim();
            const visitTopic = document.getElementById('visitTopic').value.trim();
            const visitResult = document.getElementById('visitResult').value.trim();

            let isValid = true;

            if (!doctorName) {
                showError('doctorName', '–í–≤–µ–¥–∏—Ç–µ –§–ò–û –≤—Ä–∞—á–∞');
                isValid = false;
            }

            if (!organization) {
                showError('organization', '–í–≤–µ–¥–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é');
                isValid = false;
            }

            if (!specialty) {
                showError('specialty', '–í–≤–µ–¥–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å');
                isValid = false;
            }

            if (!visitTopic) {
                showError('visitTopic', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –≤–∏–∑–∏—Ç–∞');
                isValid = false;
            }

            if (visitResult.length < 20) {
                showError('visitResult', '–ú–∏–Ω–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤');
                isValid = false;
            }

            if (isValid) {
                const userId = tg.initDataUnsafe?.user?.id;
                const savedUser = JSON.parse(localStorage.getItem('user_' + userId) || '{}');

                const visitData = {
                    type: 'doctor',
                    doctorName,
                    doctorPhone,
                    organization,
                    specialty,
                    visitTopic,
                    visitResult,
                    location: visitLocation,
                    employee: {
                        id: userId,
                        name: savedUser.name,
                        phone: savedUser.phone,
                        email: savedUser.email
                    },
                    timestamp: new Date().toISOString()
                };

                tg.sendData(JSON.stringify({
                    action: 'visit_registration',
                    data: visitData
                }));

                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                
                alert(currentLanguage === 'ru' ? '–í–∏–∑–∏—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!' : 'Tashrif muvaffaqiyatli ro\'yxatdan o\'tdi!');
                document.getElementById('doctorForm').reset();
                visitLocation = null;
                document.getElementById('locationStatus').textContent = '';
                document.getElementById('resultCounter').textContent = '0';
                showScreen('mainMenu');
            } else {
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
            }
        });

        // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        function openAdminPanel() {
            showScreen('adminLoginScreen');
            document.getElementById('adminPin1').focus();
        }

        function closeAdminPanel() {
            if (previousScreen) {
                showScreen(previousScreen);
            } else {
                showScreen('mainMenu');
            }
        }

        function checkAdminPassword() {
            const pin = ['adminPin1', 'adminPin2', 'adminPin3', 'adminPin4']
                .map(id => document.getElementById(id).value).join('');
            
            if (pin === '0101') {
                hideAllErrors();
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ email
                tg.sendData(JSON.stringify({
                    action: 'admin_login',
                    email: 'tajiev@yandex.ru',
                    user: tg.initDataUnsafe?.user
                }));
                
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                showScreen('adminPanel');
            } else {
                showError('adminPin', '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                ['adminPin1', 'adminPin2', 'adminPin3', 'adminPin4'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                document.getElementById('adminPin1').focus();
            }
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã
        function openSection(section) {
            alert(currentLanguage === 'ru' ? '–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ' : 'Ishlab chiqilmoqda');
        }

        // –£–±—Ä–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
        ['name', 'phone', 'email', 'region', 'doctorName', 'organization', 'specialty', 'visitTopic'].forEach(field => {
            const el = document.getElementById(field);
            if (el) {
                el.addEventListener('input', () => showError(field, null));
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkRegistration, 500);
        });
    </script>
</body>
</html>
