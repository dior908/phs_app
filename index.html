<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>PHS ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
  <style>
    :root {
      --bg: linear-gradient(160deg, #081226 0%, #0b2740 100%);
      --card: rgba(255,255,255,0.03);
      --accent: #6ee7b7;
      --muted: rgba(255,255,255,0.65);
      --radius: 12px;
    }
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#e6eef6;display:flex;align-items:center;justify-content:center}
    .wrap{width:98%;max-width:760px;padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 12px 40px rgba(0,0,0,0.6)}
    /* header removed per request */
    .stats-row{display:flex;gap:20px;align-items:center;justify-content:center;margin-bottom:18px}
    .stat {text-align:center;padding:10px 18px;border-radius:10px;background:var(--card);min-width:120px}
    .stat .num {font-size:28px;font-weight:800}
    .stat .label {font-size:13px;color:var(--muted);margin-top:6px}
    /* form */
    .form {display:flex;flex-direction:column;gap:12px}
    label{font-size:13px;color:var(--muted)}
    input[type="text"],input[type="tel"],input[type="date"],select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px}
    .row{display:flex;gap:10px}
    .btn{background:linear-gradient(90deg,var(--accent),#60a5fa);border:none;padding:10px 12px;border-radius:10px;color:#022633;font-weight:700;cursor:pointer}
    .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .center{display:flex;justify-content:center}
    .big-overlay{position:fixed;inset:0;background:rgba(2,6,23,0.7);display:flex;align-items:center;justify-content:center;z-index:9999}
    .card{background:#071226;padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);width:100%}
    .spinner {display:flex;align-items:center;gap:10px}
    .region-list{display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:wrap}
    .region-pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- stats simplified & centered -->
    <div class="stats-row" id="statsRow">
      <div class="stat">
        <div class="num" id="xpNum">0</div>
        <div class="label">XP</div>
      </div>
      <div class="stat">
        <div class="num" id="coinsNum">0</div>
        <div class="label">Coins</div>
      </div>
    </div>

    <!-- registration form -->
    <div class="card">
      <h2 style="margin:0 0 8px 0">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <div style="color:var(--muted);font-size:13px;margin-bottom:12px">–ù–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: –≤–≤–µ–¥–∏—Ç–µ –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</div>

      <form id="regForm" class="form" onsubmit="return onRegister(event)">
        <div>
          <label>–§–ò–û</label>
          <input type="text" id="fullName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required />
        </div>

        <div class="row">
          <div style="flex:1">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="phone" placeholder="+998901234567" required />
          </div>
          <div style="width:160px">
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input type="date" id="dob" required />
          </div>
        </div>

        <div>
          <label>–†–µ–≥–∏–æ–Ω</label>
          <!-- –ø—Ä–æ—Å—Ç–æ–π "–±–∞—Ä–∞–±–∞–Ω" ‚Äî –≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ + –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ -->
          <div style="display:flex;gap:8px;align-items:center">
            <select id="regionSelect" style="flex:1">
              <optgroup label="–†–µ–≥–∏–æ–Ω—ã –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞">
                <option>–¢–∞—à–∫–µ–Ω—Ç</option>
                <option>–ê–Ω–¥–∏–∂–∞–Ω</option>
                <option>–ë—É—Ö–∞—Ä–∞</option>
                <option>–î–∂–∏–∑–∞–∫</option>
                <option>–ö–∞—à–∫–∞–¥–∞—Ä—å—è</option>
                <option>–ù–∞–≤–æ–∏</option>
                <option>–ù–∞–º–∞–Ω–≥–∞–Ω</option>
                <option>–°–∞–º–∞—Ä–∫–∞–Ω–¥</option>
                <option>–°—É—Ä—Ö–∞–Ω–¥–∞—Ä—å—è</option>
                <option>–°—ã—Ä–¥–∞—Ä—å—è</option>
                <option>–§–µ—Ä–≥–∞–Ω–∞</option>
                <option>–•–æ—Ä–µ–∑–º</option>
                <option>–ù–¢ –≥. –¢–∞—à–∫–µ–Ω—Ç</option>
              </optgroup>
            </select>
            <button type="button" class="secondary" onclick="spinRegion()">üéõÔ∏è</button>
          </div>
        </div>

        <div>
          <label>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å (–≤–≤–µ–¥–∏—Ç–µ –¥–≤–∞–∂–¥—ã)</label>
          <div class="row">
            <input type="text" id="code1" maxlength="4" inputmode="numeric" placeholder="0000" style="width:120px" required />
            <input type="text" id="code2" maxlength="4" inputmode="numeric" placeholder="0000" style="width:120px" required />
            <div style="flex:1"></div>
          </div>
          <div id="codeHint" style="color:#fbb;display:none;font-size:13px;margin-top:6px">–ö–æ–¥—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç</div>
        </div>

        <div class="center" style="margin-top:8px">
          <button class="btn" type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>
      </form>
    </div>

  </div>

  <!-- overlay –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div id="successOverlay" class="big-overlay" style="display:none">
    <div style="background:#061226;padding:28px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);text-align:center;max-width:520px">
      <h2 id="successTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</h2>
      <p id="successText" style="color:var(--muted)">–í–∞—à–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –≤–∞–º –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏.</p>
      <div style="margin-top:14px"><button class="btn" onclick="closeSuccess()">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
  </div>

<script>
  const API_BASE = ''; // –µ—Å–ª–∏ backend –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ, —É–∫–∞–∂–∏ –ø–æ–ª–Ω—ã–π URL, –Ω–∞–ø—Ä–∏–º–µ—Ä 'https://myserver.com'

  // region spinner: –±—ã—Å—Ç—Ä—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä
  function spinRegion(){
    const sel = document.getElementById('regionSelect');
    const options = sel.options;
    const idx = Math.floor(Math.random() * options.length);
    sel.selectedIndex = idx;
    // –ª—ë–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è: —Å–º–µ–Ω–∞ 6 —Ä–∞–∑
    let i = 0;
    const orig = sel.selectedIndex;
    const timer = setInterval(()=>{
      sel.selectedIndex = (sel.selectedIndex + 1) % options.length;
      i++;
      if(i > 6 + Math.floor(Math.random()*6)){ clearInterval(timer); sel.selectedIndex = idx; }
    }, 80);
  }

  function closeSuccess(){ document.getElementById('successOverlay').style.display='none'; }

  async function onRegister(e){
    e.preventDefault();
    document.getElementById('codeHint').style.display='none';
    const name = document.getElementById('fullName').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const dob = document.getElementById('dob').value;
    const region = document.getElementById('regionSelect').value;
    const code1 = document.getElementById('code1').value.trim();
    const code2 = document.getElementById('code2').value.trim();
    if(!name || !phone || !dob || !region) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
    if(!/^\d{4}$/.test(code1) || !/^\d{4}$/.test(code2)){ document.getElementById('codeHint').textContent='–ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 4 —Ü–∏—Ñ—Ä'; document.getElementById('codeHint').style.display='block'; return; }
    if(code1 !== code2){ document.getElementById('codeHint').textContent='–ö–æ–¥—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'; document.getElementById('codeHint').style.display='block'; return; }

    // get telegram user id if available via WebApp
    let userId = null;
    try{
      if(window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user){
        userId = Telegram.WebApp.initDataUnsafe.user.id;
      }
    }catch(e){ userId = null; }
    if(!userId){
      // –¥–ª—è dev –ø–æ–ø—Ä–æ—Å–∏–º –≤–≤–µ—Å—Ç–∏ id
      userId = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID (–¥–ª—è dev —Ç–µ—Å—Ç–∞)');
      if(!userId) return;
    }

    const payload = { user_id: Number(userId), name, phone, dob, region, code: code1 };
    try{
      const resp = await fetch(API_BASE + '/auth/register', {
        method:'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const j = await resp.json();
      if(j.ok){
        // –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        document.getElementById('successTitle').textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞';
        document.getElementById('successText').textContent = '–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –≤–∞–º –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.';
        document.getElementById('successOverlay').style.display = 'flex';
        // —Å–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        document.getElementById('regForm').reset();
      } else {
        alert('–û—à–∏–±–∫–∞: ' + (j.error || JSON.stringify(j)));
      }
    } catch(err){
      console.error(err); alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
    }
    return false;
  }

  // helper: show stats - if logged in, backend /stats/get will provide
  async function loadStats(userId){
    try{
      const resp = await fetch(API_BASE + '/stats/get?user_id=' + encodeURIComponent(userId));
      const j = await resp.json();
      if(j.ok && j.stats){
        document.getElementById('xpNum').textContent = j.stats.xp || 0;
        document.getElementById('coinsNum').textContent = j.stats.coins || 0;
      }
    } catch(e){ /*ignore*/ }
  }

  // try to pre-load stats if in WebApp
  (function init(){
    try{
      const user = window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user;
      if(user && user.id) loadStats(user.id);
    } catch(e){ }
  })();
</script>
</body>
</html>
