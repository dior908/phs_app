<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞–º–∏ (–∞–¥–º–∏–Ω) -->
<div class="logo"><div class="logo-icon">üíä</div></div>
<h1>–ü—Ä–µ–ø–∞—Ä–∞—Ç—ã</h1>
<p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤</p>

<!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
<button class="btn" onclick="showAddProductForm()" style="width:100%;margin-bottom:20px;">
    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–ø–∞—Ä–∞—Ç
</button>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ -->
<div id="addProductForm" style="display:none;background:rgba(255,255,255,0.5);padding:20px;border-radius:12px;margin-bottom:20px;">
    <h3 style="margin-top:0;">–ù–æ–≤—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç</h3>
    
    <form id="productForm" onsubmit="submitProduct(event)">
        <div class="form-group">
            <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ <span class="required">*</span></label>
            <input type="text" id="productName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–∞—Ä–∞—Ü–µ—Ç–∞–º–æ–ª" required>
        </div>
        
        <div class="form-group">
            <label for="productCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="productCategory">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                <option value="–û–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–∏–µ">–û–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–∏–µ</option>
                <option value="–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏">–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏</option>
                <option value="–í–∏—Ç–∞–º–∏–Ω—ã">–í–∏—Ç–∞–º–∏–Ω—ã</option>
                <option value="–ü—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ">–ü—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ</option>
                <option value="–°–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã–µ">–°–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã–µ</option>
                <option value="–ê–Ω—Ç–∏–≥–∏—Å—Ç–∞–º–∏–Ω–Ω—ã–µ">–ê–Ω—Ç–∏–≥–∏—Å—Ç–∞–º–∏–Ω–Ω—ã–µ</option>
                <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="productDescription" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞" rows="3"></textarea>
        </div>
        
        <div style="display:flex;gap:10px;">
            <button type="submit" class="btn btn-success" style="flex:1;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" class="btn btn-secondary" onclick="hideAddProductForm()" style="flex:1;">‚úñÔ∏è –û—Ç–º–µ–Ω–∞</button>
        </div>
    </form>
</div>

<!-- –°–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ -->
<div id="productsList">
    <p style="color:#78909c;text-align:center;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</p>
</div>

<button class="btn btn-secondary" onclick="backToAdminPanel()" style="margin-top:20px;">
    ‚óÄÔ∏è –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
</button>

<script>
async function init_admin_products() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞–º–∏...');
    await loadProducts();
}

function showAddProductForm() {
    document.getElementById('addProductForm').style.display = 'block';
    document.getElementById('productName').focus();
}

function hideAddProductForm() {
    document.getElementById('addProductForm').style.display = 'none';
    document.getElementById('productForm').reset();
}

async function loadProducts() {
    const container = document.getElementById('productsList');
    container.innerHTML = '<p style="color:#78909c;text-align:center;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤...</p>';
    
    try {
        const API_URL = window.API_URL;
        
        console.log('üì° –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤...');
        
        const response = await fetch(`${API_URL}/api/products`, {
            headers: {'ngrok-skip-browser-warning': 'true'}
        });
        
        const data = await response.json();
        
        console.log('üì¶ –ü—Ä–µ–ø–∞—Ä–∞—Ç—ã:', data);
        
        if (data.success && data.products && data.products.length > 0) {
            let html = '<div style="display:grid;gap:15px;">';
            
            data.products.forEach(product => {
                const isActive = product.is_active !== false;
                const bgColor = isActive ? 'rgba(255,255,255,0.5)' : 'rgba(200,200,200,0.3)';
                
                html += `
                    <div style="background:${bgColor};padding:15px;border-radius:12px;border-left:4px solid ${isActive ? '#1976d2' : '#9e9e9e'};">
                        <div style="display:flex;justify-content:space-between;align-items:start;">
                            <div style="flex:1;">
                                <h3 style="margin:0 0 8px 0;color:#1976d2;font-size:16px;">
                                    ${product.name}
                                    ${!isActive ? '<span style="color:#9e9e9e;font-size:13px;"> (–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω)</span>' : ''}
                                </h3>
                                ${product.category ? `<p style="margin:5px 0;color:#546e7a;font-size:14px;">üìÇ ${product.category}</p>` : ''}
                                ${product.description ? `<p style="margin:5px 0;color:#78909c;font-size:13px;">${product.description}</p>` : ''}
                                <p style="margin:5px 0 0 0;color:#9e9e9e;font-size:12px;">
                                    –î–æ–±–∞–≤–ª–µ–Ω: ${new Date(product.created_date).toLocaleDateString('ru-RU')}
                                </p>
                            </div>
                            <div style="display:flex;gap:5px;margin-left:10px;">
                                <button onclick="toggleProductStatus(${product.id}, ${isActive})" 
                                        class="btn" 
                                        style="padding:8px 12px;font-size:12px;min-width:0;">
                                    ${isActive ? 'üî¥' : 'üü¢'}
                                </button>
                                <button onclick="deleteProduct(${product.id}, '${product.name.replace(/'/g, "\\'")}')" 
                                        class="btn" 
                                        style="padding:8px 12px;font-size:12px;background:#ef5350;min-width:0;">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            console.log(`‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ ${data.products.length} –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤`);
        } else {
            container.innerHTML = `
                <div style="background:rgba(255,255,255,0.3);padding:30px;border-radius:12px;text-align:center;">
                    <div style="font-size:40px;margin-bottom:15px;">üíä</div>
                    <p style="color:#78909c;">–ü—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                    <p style="color:#9e9e9e;font-size:13px;">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤:', error);
        container.innerHTML = `
            <div style="background:#ffebee;padding:20px;border-radius:12px;text-align:center;">
                <p style="color:#c62828;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤</p>
                <button class="btn" onclick="loadProducts()" style="margin-top:10px;">üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
            </div>
        `;
    }
}

async function submitProduct(event) {
    event.preventDefault();
    
    const productData = {
        name: document.getElementById('productName').value.trim(),
        category: document.getElementById('productCategory').value || null,
        description: document.getElementById('productDescription').value.trim() || null
    };
    
    console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞:', productData);
    
    try {
        const API_URL = window.API_URL;
        
        const response = await fetch(`${API_URL}/api/products`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'ngrok-skip-browser-warning': 'true'
            },
            body: JSON.stringify(productData)
        });
        
        const result = await response.json();
        
        console.log('üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
        
        if (result.success) {
            console.log(`‚úÖ –ü—Ä–µ–ø–∞—Ä–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω! ID: ${result.product_id}`);
            alert(`‚úÖ –ü—Ä–µ–ø–∞—Ä–∞—Ç "${productData.name}" –¥–æ–±–∞–≤–ª–µ–Ω!`);
            
            hideAddProductForm();
            await loadProducts();
        } else {
            throw new Error(result.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
        alert(`‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞: ${error.message}`);
    }
}

async function toggleProductStatus(productId, currentStatus) {
    try {
        const API_URL = window.API_URL;
        const newStatus = !currentStatus;
        
        console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ ${productId}: ${currentStatus} ‚Üí ${newStatus}`);
        
        const response = await fetch(`${API_URL}/api/products/${productId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'ngrok-skip-browser-warning': 'true'
            },
            body: JSON.stringify({ is_active: newStatus })
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('‚úÖ –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω');
            await loadProducts();
        } else {
            throw new Error(result.error || '–û—à–∏–±–∫–∞');
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
        alert(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
    }
}

async function deleteProduct(productId, productName) {
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–ø–∞—Ä–∞—Ç "${productName}"?`)) {
        return;
    }
    
    try {
        const API_URL = window.API_URL;
        
        console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ ${productId}`);
        
        const response = await fetch(`${API_URL}/api/products/${productId}`, {
            method: 'DELETE',
            headers: {'ngrok-skip-browser-warning': 'true'}
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('‚úÖ –ü—Ä–µ–ø–∞—Ä–∞—Ç —É–¥–∞–ª—ë–Ω');
            alert(`‚úÖ –ü—Ä–µ–ø–∞—Ä–∞—Ç "${productName}" —É–¥–∞–ª—ë–Ω`);
            await loadProducts();
        } else {
            throw new Error(result.error || '–û—à–∏–±–∫–∞');
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
        alert(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
    }
}

function backToAdminPanel() {
    // –°–∫—Ä—ã—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —ç–∫—Ä–∞–Ω
    document.getElementById('dynamicScreen').classList.add('hidden');
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
    document.getElementById('adminPanel').classList.remove('hidden');
}
</script>
